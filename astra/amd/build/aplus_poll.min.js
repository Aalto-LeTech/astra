define(["jquery"],function(a){return function(a,b,c,d){function e(b,c,d){this.element=a(b),this.callback=c,this.settings=a.extend({},g,d),this.url=null,this.count=0,this.init()}var f="aplusExercisePoll",g={poll_url_attr:"data-poll-url",ready_url_attr:"data-ready-url",poll_delays:[2,3,5,5,5,10,10,10,10],message_selector:".progress-bar",message_attr:{error:"data-msg-error",timeout:"data-msg-timeout"}};a.extend(e.prototype,{init:function(){this.element.show(),this.url=this.element.attr(this.settings.poll_url_attr),this.schedule()},poll:function(b){var c=this;a.ajax(this.url,{dataType:"html"}).fail(function(){c.message("error")}).done(function(a){c.count++,"ready"===a.trim()||"error"===a.trim()?c.ready():c.element.is(":visible")&&(c.count<c.settings.poll_delays.length?c.schedule():c.message("timeout"))})},schedule:function(){var a=this;setTimeout(function(){a.poll()},1e3*this.settings.poll_delays[this.count])},ready:function(){this.element.hide();var a=this.element.attr(this.settings.ready_url_attr);this.callback?this.callback(a):b.location=a},message:function(a){this.element.find(this.settings.message_selector).removeClass("progress-bar-animated").text(this.element.attr(this.settings.message_attr[a])),"error"==a&&this.element.find(this.settings.message_selector).addClass("bg-danger")}}),a.fn[f]=function(b,c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,c))})},a.aplusExerciseDetectWaits=function(b){a(".exercise-wait").aplusExercisePoll(b)}}(a,window,document),{}});