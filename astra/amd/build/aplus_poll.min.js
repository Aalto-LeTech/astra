define(["jquery"],function(t){return function(i,s,t,e){"use strict";var a="aplusExercisePoll",n={poll_url_attr:"data-poll-url",ready_url_attr:"data-ready-url",poll_delays:[2,3,5,5,5,10,10,10,10],message_selector:".progress-bar",message_attr:{error:"data-msg-error",timeout:"data-msg-timeout"}};function l(t,e,s){this.element=i(t),this.callback=e,this.settings=i.extend({},n,s),this.url=null,this.count=0,this.init()}i.extend(l.prototype,{init:function(){this.element.show(),this.url=this.element.attr(this.settings.poll_url_attr),this.schedule()},poll:function(t){var e=this;i.ajax(this.url,{dataType:"html"}).fail(function(){e.message("error"),e.ready(!0)}).done(function(t){e.count++,"ready"===t.trim()||"error"===t.trim()||"unofficial"===t.trim()?e.ready():e.element.is(":visible")&&(e.count<e.settings.poll_delays.length?e.schedule():(e.message("timeout"),e.ready(!0)))})},schedule:function(){var t=this;setTimeout(function(){t.poll()},1e3*this.settings.poll_delays[this.count])},ready:function(t){i.data(this.element.get(0),"plugin_"+a)&&i.removeData(this.element.get(0),"plugin_"+a);var e=this.element.attr(this.settings.ready_url_attr);this.callback?this.callback(e,t):s.location=e},message:function(t){if(this.element.find(this.settings.message_selector).removeClass("progress-bar-animated").text(this.element.attr(this.settings.message_attr[t])),this.element.attr("data-aplus-active-element")){var e="There was an error while evaluating the element.";"timeout"==t&&(e="Evaluation was timed out.");var s=this.element.find(".ae_result").text(e);0===s.height()&&s.height("auto"),i.data(this.element.get(0),"plugin_"+a)&&i.removeData(this.element.get(0),"plugin_"+a)}else"error"==t&&this.element.find(this.settings.message_selector).addClass("bg-danger")}}),i.fn[a]=function(t,e){return this.each(function(){i.data(this,"plugin_"+a)||i.data(this,"plugin_"+a,new l(this,t,e))})},i.aplusExerciseDetectWaits=function(t,e){i(e=e||".exercise-wait").aplusExercisePoll(t)}}(t,window,document),{}});