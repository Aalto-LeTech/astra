define(["jquery","core/event","mod_astra/aplus_highlightcode","theme_boost/bootstrap/dropdown","theme_boost/bootstrap/modal"],function(e,t){function i(t,e){this.element=s(t),this.settings=s.extend({},n,e),this.init()}var s,r,n,l,a,o,d;function h(t,e){this.element=l(t),this.settings=l.extend({},d,e),this.init()}return s=e,window,document,r="aplusModal",n={loader_selector:".modal-progress",loader_text_selector:".progress-bar",title_selector:".modal-title",content_selector:".modal-body",error_message_attribute:"data-msg-error"},s.extend(i.prototype,{init:function(){this.loader=this.element.find(this.settings.loader_selector),this.loaderText=this.loader.find(this.settings.loader_text_selector),this.title=this.element.find(this.settings.title_selector),this.content=this.element.find(this.settings.content_selector),this.messages={loading:this.loaderText.text(),error:this.loaderText.attr(this.settings.error_message_attribute)}},run:function(t,e){switch(t){case"open":this.open(e);break;case"error":this.showError(e);break;case"content":this.showContent(e)}},open:function(t){this.title.hide(),this.content.hide(),this.loaderText.removeClass("bg-danger").addClass("progress-bar-animated").text(t||this.messages.loading),this.loader.show(),this.element.on("hidden.bs.modal",function(t){s(".dropdown-toggle").dropdown()}),this.element.modal("show")},showError:function(t){this.loaderText.removeClass("progress-bar-animated").addClass("bg-danger").text(t||this.messages.error)},showContent:function(t){return this.loader.hide(),t.title&&(this.title.text(t.title),this.title.show()),t.content instanceof e?this.content.empty().append(t.content):this.content.html(t.content),this.content.show(),this.content}}),s.fn[r]=function(e,n,o){return this.each(function(){var t=s.data(this,"plugin_"+r);return t||(t=new i(this,o),s.data(this,"plugin_"+r,t)),t.run(e,n)})},l=e,a=t,window,document,d={modal_selector:"#page-modal",file_modal_selector:"#file-modal",body_regexp:/<body[^>]*>([\s\S]*)<\/body>/i,file:!(o="aplusModalLink")},l.extend(h.prototype,{init:function(){var o=this.element,i=this.settings;o.on("click",function(t){t.preventDefault();t=o.attr("href");if(""===t||"#"==t)return!1;var n=l(i.file?i.file_modal_selector:i.modal_selector);n.aplusModal("open"),l.get(t,function(t){var e;i.file?(e=l("<pre/>").text(t),n.aplusModal("content",{title:o.text(),content:e}),e.highlightCode()):(null!==(e=t.match(i.body_regexp))&&2==e.length&&(t=e[1]),(t=n.aplusModal("content",{content:t})).find(".file-modal").aplusModalLink({file:!0}),t.find("pre.hljs").highlightCode(),a.notifyFilterContentUpdated(i.modal_selector))}).fail(function(){n.aplusModal("error")})})}}),l.fn[o]=function(t){return this.each(function(){l.data(this,"plugin_"+o)||l.data(this,"plugin_"+o,new h(this,t))})},{}});