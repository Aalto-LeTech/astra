define(["jquery"],function(t){return function(s){"use strict";var e="aplusSearchSelect",i={widget_selector:"#search-select-widget",field_selector:'input[type="text"]',search_selector:".dropdown-toggle",result_selector:".search-options",selection_selector:".search-selected"};function n(t,e){this.element=s(t),this.timeout=null,"SELECT"==this.element.prop("tagName")&&this.element.prop("multiple")&&(this.settings=s.extend({},i,e),this.init())}s.extend(n.prototype,{init:function(){this.widget=s(this.settings.widget_selector).clone().removeAttr("id").removeClass("hide").insertBefore(this.element),this.element.hide();var e=this;this.selection=this.widget.find(this.settings.selection_selector),this.selection_li=this.selection.find("li").remove(),this.element.find("option:selected").each(function(t){e.add_selection(s(this).attr("value"),s(this).text())}),this.result=this.widget.find(this.settings.result_selector),this.field=this.widget.find(this.settings.field_selector).on("keypress",function(t){13==t.keyCode&&(t.preventDefault(),e.search_options(!0))}).on("keyup",function(t){13!=t.keyCode&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.search_options(!0),e.field.focus()},500))}),this.search=this.widget.find(this.settings.search_selector).on("show.bs.dropdown",function(t){e.search_options()}),this.element.parents("form").on("submit",function(t){e.finish()})},search_options:function(t){var i;t&&!1===this.result.is(":visible")?this.search.find("button").dropdown("toggle"):(this.result.find("li:not(.not-found)").remove(),this.result.find("li.not-found").hide(),t="option",0<this.field.val().trim().length&&(t+=":contains("+this.field.val()+")"),0===(t=this.element.find(t)).size()?this.result.find("li.not-found").show():(i=this,t.slice(0,20).each(function(t){var e=s('<li><a data-value="'+s(this).attr("value")+'">'+s(this).text()+"</a></li>");e.find("a").on("click",function(t){i.add_selection(s(this).attr("data-value"),s(this).text())}),i.result.append(e)})))},add_selection:function(t,e){var i;0===this.selection.find('[data-value="'+t+'"]').size()&&(i=this.selection_li.clone(),i.find(".name").text(e),i.find("button").attr("data-value",t).on("click",function(t){s(this).parent("li").remove()}),this.selection.append(i))},finish:function(){this.widget.remove();var e=this.element.show();e.find("option:selected").prop("selected",!1),this.selection.find("button").each(function(t){e.find('option[value="'+s(this).attr("data-value")+'"]').prop("selected",!0)})}}),s.fn[e]=function(t){return this.each(function(){s.data(this,"plugin_"+e)||s.data(this,"plugin_"+e,new n(this,t))})}}(t,(window,document)),{}});