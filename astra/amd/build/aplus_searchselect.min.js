define(["jquery"],function(t){return function(n,t,e,i){"use strict";var s="aplusSearchSelect",o={widget_selector:"#search-select-widget",field_selector:'input[type="text"]',search_selector:".dropdown-toggle",result_selector:".search-options",selection_selector:".search-selected"};function l(t,e){this.element=n(t),this.timeout=null,"SELECT"==this.element.prop("tagName")&&this.element.prop("multiple")&&(this.settings=n.extend({},o,e),this.init())}n.extend(l.prototype,{init:function(){this.widget=n(this.settings.widget_selector).clone().removeAttr("id").removeClass("hide").insertBefore(this.element),this.element.hide();var e=this;this.selection=this.widget.find(this.settings.selection_selector),this.selection_li=this.selection.find("li").remove(),this.element.find("option:selected").each(function(t){e.add_selection(n(this).attr("value"),n(this).text())}),this.result=this.widget.find(this.settings.result_selector),this.field=this.widget.find(this.settings.field_selector).on("keypress",function(t){13==t.keyCode&&(t.preventDefault(),e.search_options(!0))}).on("keyup",function(t){13!=t.keyCode&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.search_options(!0),e.field.focus()},500))}),this.search=this.widget.find(this.settings.search_selector).on("show.bs.dropdown",function(t){e.search_options()}),this.element.parents("form").on("submit",function(t){e.finish()})},search_options:function(t){if(t&&!1===this.result.is(":visible"))this.search.find("button").dropdown("toggle");else{this.result.find("li:not(.not-found)").remove(),this.result.find("li.not-found").hide();var e="option";0<this.field.val().trim().length&&(e+=":contains("+this.field.val()+")");var i=this.element.find(e);if(0===i.size())this.result.find("li.not-found").show();else{var s=this;i.slice(0,20).each(function(t){var e=n('<li><a data-value="'+n(this).attr("value")+'">'+n(this).text()+"</a></li>");e.find("a").on("click",function(t){s.add_selection(n(this).attr("data-value"),n(this).text())}),s.result.append(e)})}}},add_selection:function(t,e){if(0===this.selection.find('[data-value="'+t+'"]').size()){var i=this.selection_li.clone();i.find(".name").text(e),i.find("button").attr("data-value",t).on("click",function(t){n(this).parent("li").remove()}),this.selection.append(i)}},finish:function(){this.widget.remove();var e=this.element.show();e.find("option:selected").prop("selected",!1),this.selection.find("button").each(function(t){e.find('option[value="'+n(this).attr("data-value")+'"]').prop("selected",!0)})}}),n.fn[s]=function(t){return this.each(function(){n.data(this,"plugin_"+s)||n.data(this,"plugin_"+s,new l(this,t))})}}(t,window,document),{}});