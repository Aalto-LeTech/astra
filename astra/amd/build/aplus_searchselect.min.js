define(["jquery"],function(t){return function(t,e,i,s){"use strict";var n={widget_selector:"#search-select-widget",field_selector:'input[type="text"]',search_selector:".dropdown-toggle",result_selector:".search-options",selection_selector:".search-selected"};function o(e,i){this.element=t(e),this.timeout=null,"SELECT"==this.element.prop("tagName")&&this.element.prop("multiple")&&(this.settings=t.extend({},n,i),this.init())}t.extend(o.prototype,{init:function(){this.widget=t(this.settings.widget_selector).clone().removeAttr("id").removeClass("hide").insertBefore(this.element),this.element.hide();var e=this;this.selection=this.widget.find(this.settings.selection_selector),this.selection_li=this.selection.find("li").remove(),this.element.find("option:selected").each(function(i){e.add_selection(t(this).attr("value"),t(this).text())}),this.result=this.widget.find(this.settings.result_selector),this.field=this.widget.find(this.settings.field_selector).on("keypress",function(t){13==t.keyCode&&(t.preventDefault(),e.search_options(!0))}).on("keyup",function(t){13!=t.keyCode&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.search_options(!0),e.field.focus()},500))}),this.search=this.widget.find(this.settings.search_selector).on("show.bs.dropdown",function(t){e.search_options()}),this.element.parents("form").on("submit",function(t){e.finish()})},search_options:function(e){if(e&&!1===this.result.is(":visible"))this.search.find("button").dropdown("toggle");else{this.result.find("li:not(.not-found)").remove(),this.result.find("li.not-found").hide();var i="option";this.field.val().trim().length>0&&(i+=":contains("+this.field.val()+")");var s=this.element.find(i);if(0===s.size())this.result.find("li.not-found").show();else{var n=this;s.slice(0,20).each(function(e){var i=t('<li><a data-value="'+t(this).attr("value")+'">'+t(this).text()+"</a></li>");i.find("a").on("click",function(e){n.add_selection(t(this).attr("data-value"),t(this).text())}),n.result.append(i)})}}},add_selection:function(e,i){if(0===this.selection.find('[data-value="'+e+'"]').size()){var s=this.selection_li.clone();s.find(".name").text(i),s.find("button").attr("data-value",e).on("click",function(e){t(this).parent("li").remove()}),this.selection.append(s)}},finish:function(){this.widget.remove();var e=this.element.show();e.find("option:selected").prop("selected",!1),this.selection.find("button").each(function(i){e.find('option[value="'+t(this).attr("data-value")+'"]').prop("selected",!0)})}}),t.fn.aplusSearchSelect=function(e){return this.each(function(){t.data(this,"plugin_aplusSearchSelect")||t.data(this,"plugin_aplusSearchSelect",new o(this,e))})}}(t,window,document),{}});