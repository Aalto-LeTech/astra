{{!
Derived from A+ (a-plus/course/templates/course/module.html).

Context variables:
* course_module stdClass (exercise round) with fields id, openingtime, closingtime, name, 
        late_submissions_allowed, late_submission_deadline,
        show_late_submission_point_worth (bool), late_submission_point_worth (0-100),
        status_ready (bool), status_maintenance (bool), introduction (HTML string)
        show_required_points (bool, status ready and points to pass > 0), points_to_pass,
        expired (bool, has been closed), open (bool), not_started (bool, has not been opened yet),
        is_course_staff (bool), url (string)
* module_summary stdClass (summary of the student's status in the exercise round)
        fields that are required by _points_badge.mustache
* toDateStr callable Function that converts a Unix timestamp to a date string
* categories array of arrays. The outer array must have numeric indexes and the inner arrays must
        have keys id (category ID), name (category name),
        exercise_summaries (array of arrays), the inner arrays have keys
            exercise (object with keys url, name, submissionlisturl, status_unlisted (bool), parenturl, can_view_submissions),
            exercise_summary (object with keys that are required by _points_badge.mustache)

}}
<div class="card module-panel{{# course_module.expired }} module-expired{{/ course_module.expired }}">
  <div class="card-header card-primary card-inverse">
  <a href="{{{ course_module.url }}}">
  <h3 class="card-title">
    {{# module_summary }}
      {{> mod_astra/_points_badge }}
    {{/ module_summary }}
    {{# course_module.not_started }}
    <span class="badge badge-secondary float-right">
      {{#str}} opens, mod_astra {{/str}} {{# toDateStr }}{{ course_module.openingtime }}{{/ toDateStr }}
    </span>
    {{/ course_module.not_started }}
    {{ course_module.name }}
  </h3>
  </a>
  </div>
<div id="module{{ course_module.id }}">
  <div class="card-block">
    <p>
      {{# toDateStr }}{{ course_module.openingtime }}{{/ toDateStr }} &ndash; {{# toDateStr }}{{ course_module.closingtime }}{{/ toDateStr }}

      {{# course_module.late_submissions_allowed }}
      <br>
      <em>
        {{#str}}
        latealloweduntil, mod_astra, {{# toDateStr }}{{ course_module.late_submission_deadline }}{{/ toDateStr }}
        {{/str}}
        {{# course_module.show_late_submission_point_worth }}
        {{#str}} latepointsworth, mod_astra, {{ course_module.late_submission_point_worth }} {{/str}}
        {{/ course_module.show_late_submission_point_worth }}
      </em>
      {{/ course_module.late_submissions_allowed }}

      {{# course_module.show_required_points }}
      <br>
      {{#str}} pointsrequiredtopass, mod_astra, {{ course_module.points_to_pass }} {{/str}}
      {{/ course_module.show_required_points }}
    </p>

    {{# course_module.status_maintenance }}
    <p>
      {{#str}} undermaintenance, mod_astra {{/str}}
    </p>
    {{/ course_module.status_maintenance }}
    {{^ course_module.status_maintenance }}
      {{^ course_module.not_started }}
        {{# module_summary }}
          {{> mod_astra/_points_progress }}
        {{/ module_summary }}
        {{{ course_module.introduction }}}
      {{/ course_module.not_started }}
      {{# course_module.not_started }}
        <p>{{#str}} notopenedyet, mod_astra {{/str}}</p>
      {{/ course_module.not_started }}
    {{/ course_module.status_maintenance }}
  </div>
  {{# course_module.status_ready }}
  <table class="table table-striped table-sm results-table">
    <tbody>
      {{# categories }}
      <tr class="category-row" data-category="{{ id }}">
        <td>{{ name }}</td>
        {{# course_module.is_course_staff }}
        <td>{{#str}} coursestaff, mod_astra {{/str}}</td>
        {{/ course_module.is_course_staff }}
        <td>{{#str}} points, mod_astra {{/str}}</td>
      </tr>
      {{# exercise_summaries }}
      <tr data-category="{{ id }}">
        <td>
          {{^ course_module.not_started }}
            {{# exercise.status_unlisted }}
              <a href="{{{ exercise.parenturl }}}">{{ exercise.name }}</a>
            {{/ exercise.status_unlisted }}
            {{^ exercise.status_unlisted }}
              <a href="{{{ exercise.url }}}">{{ exercise.name }}</a>
            {{/ exercise.status_unlisted }}
          {{/ course_module.not_started }}
          {{# course_module.not_started }}
            {{ exercise.name }}
          {{/ course_module.not_started }}
        </td>
        {{# course_module.is_course_staff }}
        <td>
          {{# course_module.not_started }}
          <a class="btn btn-secondary btn-sm" href="{{{ exercise.url }}}">
            {{#pix}}i/lock{{/pix}}
            {{#str}} earlyaccess, mod_astra {{/str}}
          </a>
          {{/ course_module.not_started }}
          {{# exercise.can_view_submissions }}
          <a class="btn btn-secondary btn-sm" href="{{{ exercise.submissionlisturl }}}">
            {{#pix}}a/view_list_active{{/pix}}
            {{#str}} viewsubmissions, mod_astra {{/str}}
          </a>
          {{/ exercise.can_view_submissions }}
        </td>
        {{/ course_module.is_course_staff }}
        <td>
          {{# exercise_summary }}
            {{> mod_astra/_points_badge }}
          {{/ exercise_summary }}
        </td>
      </tr>
      {{/ exercise_summaries }}
      {{/ categories }}
    </tbody>
  </table>
  {{/ course_module.status_ready }}
</div>
</div>
